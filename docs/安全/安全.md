# 安全

**常见的安全问题**

## xss

全称 Cross-Site Scripting 俗称 跨站点攻击，是指通过`利用网页开发时留下的漏洞`，通过巧妙的方法`注入恶意指令代码`到网页, 用户加载并执行攻击者恶意制造的网页程序

**危害**

- 获取当前用户在这个网站的cookies，从而拿到用户的敏感信息；
- 以当前用户的身份发起一些非用户本意的操作请求，比如删除网站好友，发帖，发私信等等；
- 实现DDos攻击；


根据攻击来源，可以分为`持久型攻击`和`非持久型攻击`

**非持久型攻击**

通过诱骗短信等方式，让用户跳转带有攻击意图的参数，由于处理逻辑落洞，导致用户执行恶意代码

**持久型攻击**

假如网站的评论区未作过滤的安全处理，那就可以通过评论的方式将恶意脚本提交至后台服务器，之后任何访问了此评论页面的用户，都会执行到我的代码，从而达到攻击目的。

### 防御方式

1. 想办法阻止恶意代码的注入和执行；
   1. 使用html转义，将 `script` `&` `<` `>` `"` `'` `/` 做过滤转移
2. 用更安全的方法校验和保护用户的身份凭证，以降低XSS攻击之后带来的危害；
  1. 开启CSP防护。 通过在HTTP头部中设置Content-Security-Policy,就可以配置该策略；
3. 设置HttpOnly。 可以降低xss攻击用户造成cookie泄漏风险

如果将CSP设置成一下模式：

```
Content-Security-Policy: script-src 'self'
```

1. 不允许内联脚本执行;
2. 禁止加载外域代码;
3. 禁止外域提交; 这将有效地防范XSS的攻击，当然他也非常严格，可能会对自身的业务开发也造成一定限制，更多关于CSP的内容可以查看




## csrf

全称 `Cross-site request forgery` 跨站请求伪造；攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。


CSRF的攻击流程：

1、受害者登录目标网站A；
2、受害者以某种方式接触到恶意网站B的链接；
3、受害者点击链接访问网站B, 网站B中的js代码执行, 偷偷向目标网站A发送某个请求；
4、由于受害者登录过网站A, 因此请求携带了网站A的相关cookie凭证，最后请求成功执行；


防御

1. SameSite Cookie 
   1. 可以设置 strict lax none 三个值
      1. strict 严格模式，完全禁止第三方 Cookie
      2. lax 允许第三方get请求
      3. none 关闭samesite属性
2. CSRF Token
   1. 在用户访问网站时，后台服务器根据算法再生成一个Token，然后把这个Token放在seesion中，当网站发起请求时，不仅要携带cookie凭证，还要把这个Token也带上，后台一起校验之后确认身份再执行操作
3. 同源检测
   1. 后台服务器可以通过检查 origin referer 是否来自自己的网站，
4. 增加二次验证，比如危险操作，需要手机验证码、邮箱验证码、图形验证码进行验证，